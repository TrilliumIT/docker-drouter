language: go
go: 
  - 1.6.2

env:
  - GO15VENDOREXPERIMENT=1

sudo: required

services:
  - docker

before_install:
  - sudo apt-get -o Dpkg::Options::="--force-confnew" install -y docker-engine
  - docker pull alpine
  - go get -u github.com/alecthomas/gometalinter
  - $GOPATH/bin/gometalinter --install --update
  - go get github.com/Masterminds/glide
  - go get github.com/wadey/gocovmerge
  - go get github.com/mattn/goveralls
  - go get golang.org/x/tools/cmd/cover

install:
  - $GOPATH/bin/glide install
  - go build -i

before_script:
  - docker build -t droutertest -f ./Dockertest .

script:
  - ./locallint.sh
  - ./localtest.sh
  - docker run -it --privileged --rm --pid=host -v /var/run/docker.sock:/var/run/docker.sock -e TRAVIS_JOB_ID=$TRAVIS_JOB_ID -e TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST droutertest '$GOPATH/bin/goveralls -service=travis-ci ./drouter'
  - $GOPATH/bin/goveralls -service=travis-ci -coverprofile=./coverage/cover.out
